<cs-loading *ngIf="!application"></cs-loading>

<div *ngIf="application">
  <div class="row">
    <div class="col-lg-12">
      <div class="btn-group btn-group-padded pull-left">

        <div class="btn-group" dropdown [(isOpen)]="status.isOpen">
          <button id="single-button" type="button" class="btn btn-info" dropdownToggle [disabled]="disabled">
            {{regionConstraint.preferred_region_area == null ? 'Select region' : regionConstraint.preferred_region_area}} <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu" aria-labelledby="single-button">
            <li role="menuitem"><a class="dropdown-item" (click)="changeRegion('US')">United States</a></li>
            <li role="menuitem"><a class="dropdown-item" (click)="changeRegion('EU')">Europe</a></li>
            <li role="menuitem"><a class="dropdown-item" (click)="changeRegion('ASIA')">Asia-Pacific</a></li>
            <li role="menuitem"><a class="dropdown-item" (click)="changeRegion('SA')">South America</a></li>
          </ul>
        </div>

      </div>

      <div class="btn-group btn-group-padded pull-right">

        <button [ngClass]="{'disabled': recommendation.isGenerating}" class="btn btn-primary" (click)="triggerRecommendation(application)">
          <i [ngClass]="{ 'fa-copy': !recommendation.isGenerating,
                          'fa-spin': recommendation.isGenerating,
                          'fa-circle-o-notch': recommendation.isGenerating}"
          class="fa"></i>
          Generate Recommendation
        </button>

      </div>
    </div>
  </div>
  <div class="row" style="margin-top: 40px;">
    <div class="col-lg-9">
      <div class="overflow-hidden">
        <div class="application-editor" [csConnection]="application">

          <cs-stove-editor-dependency-constraint
            *ngFor="let constraint of applicationData.links; let i = index"
            [constraint]="constraint"
            class="svg"
            >
          </cs-stove-editor-dependency-constraint>

          <cs-stove-editor-ingredient
            *ngFor="let ingredient of application.children; trackBy: ingredient?.id; let i = index"
            [ingredient]="ingredient"
            (ingredientClicked)="openModal($event)"
            [csPosition]="i"
            csDraggable>
          </cs-stove-editor-ingredient>

        </div>
      </div>
    </div>
    <div class="col-lg-3 animated-list" *ngFor="let recommendation of recommendations">
        <div class="panel panel-default panel-application">
          <div class="panel-heading">
            <h3 class="panel-title">
              Recommendation<br>
              Cost: {{recommendation.vm_cost}}<br>
            </h3>
            <a class="btn btn-primary btn-xs" (click)="applyRecommendation(recommendation)">Apply</a>
          </div>
        </div>
    </div>
  </div>

  <div bsModal #lgModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md">
      <div class="modal-content" *ngIf="activeIngredient">
        <div class="modal-header">
          <button type="button" class="close" (click)="lgModal.hide()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title">{{activeIngredient.name}}</h4>
        </div>
        <div class="modal-body">
          <div class="row">
            <cs-ingredient-detail [(ingredient)]="activeIngredient"></cs-ingredient-detail>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
