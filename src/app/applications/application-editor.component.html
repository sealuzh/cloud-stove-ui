<cs-loading *ngIf="!application"></cs-loading>

<div *ngIf="application">
  <div class="row">
    <div class="col-lg-12">
      <div class="btn-group btn-group-padded pull-left">

        <div class="btn-group" dropdown [(isOpen)]="status.regionIsOpen">
          <button id="single-button" type="button" class="btn btn-info" dropdownToggle [disabled]="disabled">
            {{regionConstraint.preferred_region_area == null ? 'Region' : 'Region: ' + regionConstraint.preferred_region_area}} <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu" aria-labelledby="single-button">
            <li role="menuitem"  *ngFor='let region of selectableRegions'>
              <a class="dropdown-item" (click)="changeRegion(region.id)">{{region.name}}</a>
            </li>
          </ul>
        </div>

        <div class="btn-group" dropdown [(isOpen)]="status.providerIsOpen">
          <button id="single-button" type="button" class="btn btn-info" dropdownToggle [disabled]="disabled">
            {{providerConstraint.preferred_providers.length == 0 ? 'Provider' : providerConstraint.preferred_providers.join(', ') }} <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu" aria-labelledby="single-button">
            <li role="menuitem" *ngFor='let provider of selectableProviders'>
              <a class="dropdown-item" (click)="selectProvider(provider)">
                {{providerConstraint.preferred_providers.indexOf(provider) > -1 ? 'âœ“' : '' }} {{provider}}
              </a>
            </li>
          </ul>
        </div>

      </div>

      <div class="btn-group btn-group-padded pull-right">

        <button [ngClass]="{'disabled': recommendation.isGenerating}" class="btn btn-primary" (click)="triggerRecommendation(application)">
          <i [ngClass]="{ 'fa-copy': !recommendation.isGenerating,
                          'fa-spin': recommendation.isGenerating,
                          'fa-circle-o-notch': recommendation.isGenerating}"
          class="fa"></i>
          Generate Recommendation
        </button>

      </div>
    </div>
  </div>
  <div class="row" style="margin-top: 40px;">
    <div class="col-lg-9">
      <div class="overflow-hidden">
        <div class="application-editor" csConnection>

          <cs-stove-editor-dependency-constraint
            *ngFor="let constraint of applicationData.links; let i = index"
            [constraint]="constraint"
            class="svg"
            >
          </cs-stove-editor-dependency-constraint>

          <cs-stove-editor-ingredient
            *ngFor="let ingredient of application.children; trackBy: ingredient?.id; let i = index"
            [ingredient]="ingredient"
            (ingredientClicked)="openModal($event)"
            [csPosition]="i"
            csDraggable>
          </cs-stove-editor-ingredient>

        </div>
      </div>
    </div>
    <div class="col-lg-3">
      <div class="animated-list" *ngFor="let rec of recommendations">
        <div class="panel panel-default panel-application"  [ngClass]="{'recommendation-active': recommendation.activeRecommendation && recommendation.activeRecommendation === rec }" (click)="applyRecommendation(rec)">
          <div class="panel-heading">
            <h3 class="panel-title">
              Monthly VM-Cost: {{rec.vm_cost}}<br>
              <small>generated on {{ stringAsDate(rec.created_at) | date: 'H:m dd/MM/yyyy' }}</small>
            </h3>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div bsModal #lgModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md">
      <div class="modal-content" *ngIf="activeIngredient">
        <div class="modal-header">
          <button type="button" class="close" (click)="lgModal.hide()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title">{{activeIngredient.name}}</h4>
        </div>
        <div class="modal-body">
          <div class="row">
            <cs-ingredient-detail [(ingredient)]="activeIngredient"></cs-ingredient-detail>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
